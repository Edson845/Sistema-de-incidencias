<div class="edit-container">
  <div class="header-section">
    <h2>Editar Usuario</h2>
    <p class="subtitle">Actualice la informaci√≥n del usuario y gestione sus credenciales</p>
  </div>

  <div class="form-grid">
    <!-- SECCI√ìN 1: DATOS PERSONALES -->
    <div class="form-section">
      <h3>Informaci√≥n Personal</h3>

      <div class="input-group">
        <label>DNI (No editable)</label>
        <input type="text" [(ngModel)]="usuario.dni" disabled class="input-disabled" />
      </div>

      <div class="row">
        <div class="input-group">
          <label>Nombres</label>
          <input type="text" [(ngModel)]="usuario.nombres" placeholder="Ingrese nombres" />
        </div>
        <div class="input-group">
          <label>Apellidos</label>
          <input type="text" [(ngModel)]="usuario.apellidos" placeholder="Ingrese apellidos" />
        </div>
      </div>

      <div class="row">
        <div class="input-group">
          <label>Correo Electr√≥nico</label>
          <input type="email" [(ngModel)]="usuario.correo"
            [placeholder]="esTecnico ? 'usuario@ejemplo.com' : 'ejemplo@munisanroman.gob.pe'" />
          <small *ngIf="!esTecnico && usuario.idRol"
            style="color: #6b7280; font-size: 12px; display: block; margin-top: 4px;">
            Solo correos institucionales (@munisanroman.gob.pe)
          </small>
          <small *ngIf="esTecnico" style="color: #10b981; font-size: 12px; display: block; margin-top: 4px;">
            ‚úì Puedes usar cualquier correo v√°lido
          </small>
        </div>
        <div class="input-group">
          <label>Celular</label>
          <input type="text" [(ngModel)]="usuario.celular" (input)="soloNumeros($event)" maxlength="9"
            placeholder="999999999" />
        </div>
      </div>
    </div>

    <!-- SECCI√ìN 2: ROL Y CARGO -->
    <div class="form-section">
      <h3>Rol y Cargo</h3>

      <div class="row">
        <div class="input-group">
          <label>Rol de Sistema</label>
          <select [(ngModel)]="usuario.idRol" (change)="onRolChange()">
            <option value="" disabled>Seleccione un rol</option>
            <option *ngFor="let rol of roles" [value]="rol.idRol || rol.idrol">{{ rol.nombreRol }}</option>
          </select>
        </div>
        <div class="input-group">
          <label>Cargo Institucional</label>
          <select [(ngModel)]="usuario.idCargo" (change)="onCargoChange()">
            <option value="" disabled>Seleccione un cargo</option>
            <option *ngFor="let cargo of cargos" [value]="cargo.idCargo">{{ cargo.nombreCargo }}</option>
          </select>
        </div>
      </div>

      <!-- L√≥gica condicional de dependencias (igual que en create) -->
      <div class="conditional-fields">
        <!-- Solo Gerencia -->
        <div class="input-group" *ngIf="mostrarGerencias">
          <label>Gerencia</label>
          <select [(ngModel)]="usuario.idGerencia">
            <option value="" disabled>Seleccione Gerencia</option>
            <option *ngFor="let g of gerencias" [value]="g.idGerencia">{{ g.nombreGerencia }}</option>
          </select>
        </div>

        <!-- Solo Departamento -->
        <div class="input-group" *ngIf="mostrarDepartamentos">
          <label>Departamento</label>
          <select [(ngModel)]="usuario.idDepartamento">
            <option value="" disabled>Seleccione Departamento</option>
            <option *ngFor="let d of departamentos" [value]="d.idDepartamento">{{ d.nombreDepartamento }}</option>
          </select>
        </div>

        <!-- Solo Oficina -->
        <div class="input-group" *ngIf="mostrarOficinas">
          <label>Oficina</label>
          <select [(ngModel)]="usuario.idOficina">
            <option value="" disabled>Seleccione Oficina</option>
            <option *ngFor="let o of oficinas" [value]="o.idOficina">{{ o.nombreOficina }}</option>
          </select>
        </div>

        <!-- Rango Unidad -->
        <div class="input-group" *ngIf="mostrarRangoUnidad">
          <label>Ubicaci√≥n del Personal</label>
          <select [(ngModel)]="rangeUnidad" (change)="onRangoUnidadChange(rangeUnidad)">
            <option value="" disabled>Seleccione Ubicaci√≥n</option>
            <option value="1">Gerencia</option>
            <option value="2">Departamento</option>
            <option value="3">Oficina</option>
          </select>
        </div>
      </div>
    </div>

    <!-- SECCI√ìN 3: SEGURIDAD (NUEVO) -->
    <div class="form-section security-section">
      <h3>Seguridad</h3>
      <div class="security-alert">
        <span class="icon">üîí</span>
        <p>Solo ingrese una contrase√±a si desea restablecerla. De lo contrario, d√©jelo en blanco.</p>
      </div>

      <div class="input-group">
        <label>Nueva Contrase√±a</label>
        <input type="password" [(ngModel)]="usuario.password" placeholder="Dejar en blanco para mantener la actual"
          autocomplete="new-password" />
      </div>
    </div>
  </div>

  <!-- ACCIONES -->
  <div class="actions-bar">
    <button class="btn-cancel" (click)="cancelar()">Cancelar</button>
    <button class="btn-save" (click)="guardarCambios()" [disabled]="loading">
      {{ loading ? 'Guardando...' : 'Guardar Cambios' }}
    </button>
  </div>

  <!-- MENSAJES -->
  <div *ngIf="mensaje" class="mensaje-flotante" [ngClass]="tipoMensaje">
    {{ mensaje }}
  </div>
</div>