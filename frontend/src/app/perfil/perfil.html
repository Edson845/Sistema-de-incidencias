<!-- PERFIL DE USUARIO -->
<div class="perfil-wrapper">

  <!-- Tarjeta principal del perfil -->
  <mat-card class="perfil-card">

    <!-- Header con foto de perfil -->
    <div class="perfil-header">
      <div class="avatar-container">
        <img [src]="previewUrl || (perfil.avatar ? 'http://localhost:3000' + perfil.avatar : 'assets/preder.png')"
          class="avatar" alt="Foto de perfil">
        <button *ngIf="editMode" mat-mini-fab color="primary" class="avatar-edit-btn" (click)="fileInput.click()">
          <mat-icon>photo_camera</mat-icon>
        </button>
        <input #fileInput type="file" (change)="onFileSelected($event)" accept="image/*" style="display: none;">
      </div>

      <h1 class="perfil-nombre">{{ perfil.nombres }} {{ perfil.apellidos }}</h1>
      <p class="perfil-cargo">{{ perfil.nombreCargo || 'Sin cargo asignado' }}</p>
    </div>

    <mat-divider></mat-divider>

    <!-- Informaci√≥n Personal -->
    <div *ngIf="rolUsuario === 'admin'" class="perfil-section">
      <h2 class="section-title">
        <mat-icon>person</mat-icon>
        Informaci√≥n Personal
      </h2>

      <div class="info-grid">
        <!-- DNI -->
        <div class="info-item">
          <mat-icon class="info-icon">badge</mat-icon>
          <div class="info-content">
            <label>DNI</label>
            <span>{{ perfil.dni }}</span>
          </div>
        </div>

        <!-- Usuario -->
        <div class="info-item">
          <mat-icon class="info-icon">account_circle</mat-icon>
          <div class="info-content">
            <label>Usuario</label>
            <input *ngIf="editMode" [(ngModel)]="perfil.usuario" class="edit-input" placeholder="Usuario">
            <span *ngIf="!editMode">{{ perfil.usuario }}</span>
          </div>
        </div>

        <!-- Nombre Completo -->
        <div class="info-item full-width">
          <mat-icon class="info-icon">person_outline</mat-icon>
          <div class="info-content">
            <label>Nombre Completo</label>
            <span>{{ perfil.nombres }} {{ perfil.apellidos }}</span>
          </div>
        </div>
      </div>
    </div>

    <mat-divider></mat-divider>

    <!-- Informaci√≥n de Contacto -->
    <div class="perfil-section">
      <h2 class="section-title">
        <mat-icon>contacts</mat-icon>
        Informaci√≥n de Contacto
      </h2>

      <div class="info-grid">
        <!-- Correo Institucional -->
        <div class="info-item full-width">
          <mat-icon class="info-icon">email</mat-icon>
          <div class="info-content">
            <label>Correo Institucional</label>
            <input *ngIf="editMode" [(ngModel)]="perfil.correo" type="email" class="edit-input"
              placeholder="correo@munisanroman.gob.pe">
            <span *ngIf="!editMode">{{ perfil.correo || 'No registrado' }}</span>
          </div>
        </div>

        <!-- N√∫mero de Celular -->
        <div class="info-item">
          <mat-icon class="info-icon">phone</mat-icon>
          <div class="info-content">
            <label>N√∫mero de Celular</label>
            <input *ngIf="editMode" [(ngModel)]="perfil.celular" class="edit-input" placeholder="999 999 999">
            <span *ngIf="!editMode">{{ perfil.celular || 'No registrado' }}</span>
          </div>
        </div>
      </div>
    </div>

    <mat-divider></mat-divider>

    <!-- Informaci√≥n Organizacional -->
    <div class="perfil-section">
      <h2 class="section-title">
        <mat-icon>business</mat-icon>
        Informaci√≥n Organizacional
      </h2>

      <div class="info-grid">
        <!-- Oficina/Departamento/Gerencia -->
        <div class="info-item full-width">
          <mat-icon class="info-icon">corporate_fare</mat-icon>
          <div class="info-content">
            <label>√Årea de Trabajo</label>
            <span>{{ perfil.nombreOficina || 'No asignado' }}</span>
          </div>
        </div>

        <!-- Cargo -->
        <div class="info-item full-width">
          <mat-icon class="info-icon">work</mat-icon>
          <div class="info-content">
            <label>Cargo</label>
            <span>{{ perfil.nombreCargo || 'No especificado' }}</span>
          </div>
        </div>
      </div>
    </div>

    <mat-divider></mat-divider>

    <!-- Botones de Acci√≥n -->
    <div class="perfil-actions">
      <!-- Botones de edici√≥n (solo para el usuario autenticado) -->
      <div *ngIf="!modoSoloLectura">
        <div *ngIf="!editMode" class="action-buttons">
          <button mat-raised-button color="primary" (click)="activarEdicion()">
            <mat-icon>edit</mat-icon>
            Editar Perfil
          </button>
          <button mat-raised-button color="accent" (click)="abrirModalContrasenia()">
            <mat-icon>lock</mat-icon>
            Cambiar Contrase√±a
          </button>
        </div>

        <div *ngIf="editMode" class="action-buttons">
          <button mat-raised-button color="primary" (click)="actualizarPerfil()">
            <mat-icon>save</mat-icon>
            Guardar Cambios
          </button>
          <button mat-raised-button (click)="cancelarEdicion()">
            <mat-icon>cancel</mat-icon>
            Cancelar
          </button>
        </div>
      </div>

      <!-- Bot√≥n volver (solo cuando admin ve otro usuario) -->
      <div *ngIf="modoSoloLectura" class="action-buttons">
        <button mat-raised-button (click)="volver()">
          <mat-icon>arrow_back</mat-icon>
          <span *ngIf="esAdmin">Volver a Lista de Usuarios</span>
          <span *ngIf="!esAdmin">Volver</span>
        </button>
      </div>
    </div>

  </mat-card>

</div>

<!-- MODAL CAMBIAR CONTRASE√ëA -->
<div class="modal-overlay" *ngIf="modalContrasenia" (click)="cerrarModalContrasenia()">
  <div class="modal" (click)="$event.stopPropagation()">

    <h3>üîí Cambiar Contrase√±a</h3>

    <div class="tab-content">
      <label>Contrase√±a Actual <span class="required">*</span></label>
      <input type="password" [(ngModel)]="formContrasenia.actual" placeholder="Ingresa tu contrase√±a actual">

      <label>Nueva Contrase√±a <span class="required">*</span></label>
      <input type="password" [(ngModel)]="formContrasenia.nueva" placeholder="M√≠nimo 6 caracteres">

      <label>Confirmar Nueva Contrase√±a <span class="required">*</span></label>
      <input type="password" [(ngModel)]="formContrasenia.confirmar" placeholder="Repite la nueva contrase√±a">
    </div>

    <div class="modal-buttons">
      <button class="btn-confirm" (click)="cambiarContrasenia()">
        ‚úÖ Cambiar
      </button>
      <button class="btn-cancelar" (click)="cerrarModalContrasenia()">
        ‚ùå Cancelar
      </button>
    </div>

  </div>
</div>