<div class="tickets-container">
  <h2>Gesti√≥n de Tickets</h2>

  <!-- üîπ Controles superiores -->
  <div class="top-bar">
    <!-- Bot√≥n agregar -->
    <button class="btn-agregar" (click)="crearTicket()">‚ûï Nuevo Ticket</button>

    <!-- Barra de b√∫squeda -->
    <input
      type="text"
      [(ngModel)]="filtro"
      placeholder="üîç Buscar por t√≠tulo o usuario..."
      class="search-input"
      (input)="filtrarTickets()"
    />
  </div>

  <!-- Indicadores de carga o error -->
  <div *ngIf="loading" class="mensaje info">Cargando tickets...</div>
  <div *ngIf="error" class="mensaje error">{{ error }}</div>

  <!-- Tabla de tickets -->
  <div *ngIf="!loading && ticketsFiltrados.length > 0" class="tabla-responsive">
    <table class="tickets-tabla">
      <thead>
        <tr>
          <th>ID</th>
          <th>T√≠tulo</th>
          <th>Descripci√≥n</th>
          <th>Asignado A</th>
          <th>Fecha Creaci√≥n</th>
          <th>Categor√≠a</th>
          <th>Estado</th>
          <th *ngIf="rolUsuario === 'admin'">Prioridad</th>
          <th *ngIf="rolUsuario === 'admin'">Usuario</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let t of ticketsFiltrados">
          <td>{{ t.idTicket }}</td>
          <td>{{ t.tituloTicket }}</td>
          <td>{{ t.descTicket }}</td>
          <td>{{ t.asignadoA }}</td>
          <td>{{ t.fechaCreacion | date:'dd/MM/yyyy HH:mm'}}</td>
          <td>{{ t.idCategoria }}</td>
          <td>{{ t.idEstado }}</td>

          <!-- Solo visible para admin -->
          <td *ngIf="rolUsuario === 'admin'">
            <span
              [ngClass]="{
                'prioridad-baja': t.idPrioridad == 1,
                'prioridad-media': t.idPrioridad == 3,
                'prioridad-alta': t.idPrioridad >= 4
              }"
            >
              {{ t.idPrioridad }}
            </span>
          </td>
          <td *ngIf="rolUsuario === 'admin'">{{ t.usuarioCrea }}</td>

          <!-- Acciones -->
          <td>
            <button class="btn-ver" (click)="verTicket(t.idTicket)">üëÅ Ver</button>
            <button class="btn-editar" (click)="editarTicket(t.idTicket)">‚úèÔ∏è Editar</button>

            <!-- Bot√≥n Asignar solo para admin -->
            <button
              *ngIf="rolUsuario === 'admin'"
              class="btn-asignar"
              (click)="asignarTicket(t.idTicket)"
            >
              üõ† Asignar
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Mensaje si no hay tickets -->
  <div *ngIf="!loading && ticketsFiltrados.length === 0" class="mensaje vacio">
    No se encontraron tickets.
  </div>
</div>
