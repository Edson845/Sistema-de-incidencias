<!-- Modal Header -->
<div class="modal-header">
  <h2>Evaluación del Ticket</h2>
  <p class="subtitle">{{ getSubtitle() }}</p>
</div>

<div class="modal-content">

  <!-- ⭐ Vista para USUARIO -->
  <div *ngIf="rol === 'usuario'" class="user-section">

    <!-- Sistema de Calificación con Caritas -->
    <div class="rating-section">
      <label class="section-label">¿Cómo calificarías el servicio?</label>
      <div class="emoji-rating">
        <!-- Excelente - 5 -->
        <div class="emoji-option" [class.selected]="calificacion === 5" (click)="setCalificacion(5)">
          <div class="emoji-circle happy-5">
            <svg viewBox="0 0 100 100" class="emoji-face">
              <circle cx="50" cy="50" r="45" fill="currentColor" />
              <circle cx="35" cy="40" r="5" fill="#000" />
              <circle cx="65" cy="40" r="5" fill="#000" />
              <path d="M 30 55 Q 50 75 70 55" stroke="#000" stroke-width="4" fill="none" stroke-linecap="round" />
            </svg>
          </div>
          <div class="stars">★★★★★</div>
          <span class="emoji-label">Excelente</span>
        </div>

        <!-- Buena - 4 -->
        <div class="emoji-option" [class.selected]="calificacion === 4" (click)="setCalificacion(4)">
          <div class="emoji-circle happy-4">
            <svg viewBox="0 0 100 100" class="emoji-face">
              <circle cx="50" cy="50" r="45" fill="currentColor" />
              <circle cx="35" cy="40" r="5" fill="#000" />
              <circle cx="65" cy="40" r="5" fill="#000" />
              <path d="M 35 60 Q 50 70 65 60" stroke="#000" stroke-width="4" fill="none" stroke-linecap="round" />
            </svg>
          </div>
          <div class="stars">★★★★☆</div>
          <span class="emoji-label">Buena</span>
        </div>

        <!-- Regular - 3 -->
        <div class="emoji-option" [class.selected]="calificacion === 3" (click)="setCalificacion(3)">
          <div class="emoji-circle neutral-3">
            <svg viewBox="0 0 100 100" class="emoji-face">
              <circle cx="50" cy="50" r="45" fill="currentColor" />
              <circle cx="35" cy="40" r="5" fill="#000" />
              <circle cx="65" cy="40" r="5" fill="#000" />
              <line x1="35" y1="65" x2="65" y2="65" stroke="#000" stroke-width="4" stroke-linecap="round" />
            </svg>
          </div>
          <div class="stars">★★★☆☆</div>
          <span class="emoji-label">Regular</span>
        </div>

        <!-- Mala - 2 -->
        <div class="emoji-option" [class.selected]="calificacion === 2" (click)="setCalificacion(2)">
          <div class="emoji-circle sad-2">
            <svg viewBox="0 0 100 100" class="emoji-face">
              <circle cx="50" cy="50" r="45" fill="currentColor" />
              <circle cx="35" cy="40" r="5" fill="#000" />
              <circle cx="65" cy="40" r="5" fill="#000" />
              <path d="M 35 70 Q 50 60 65 70" stroke="#000" stroke-width="4" fill="none" stroke-linecap="round" />
            </svg>
          </div>
          <div class="stars">★★☆☆☆</div>
          <span class="emoji-label">Mala</span>
        </div>

        <!-- Muy Mala - 1 -->
        <div class="emoji-option" [class.selected]="calificacion === 1" (click)="setCalificacion(1)">
          <div class="emoji-circle sad-1">
            <svg viewBox="0 0 100 100" class="emoji-face">
              <circle cx="50" cy="50" r="45" fill="currentColor" />
              <circle cx="35" cy="38" r="5" fill="#000" />
              <circle cx="65" cy="38" r="5" fill="#000" />
              <path d="M 30 75 Q 50 55 70 75" stroke="#000" stroke-width="4" fill="none" stroke-linecap="round" />
              <circle cx="72" cy="35" r="2" fill="#000" opacity="0.5" />
            </svg>
          </div>
          <div class="stars">★☆☆☆☆</div>
          <span class="emoji-label">Muy Mala</span>
        </div>
      </div>

      <!-- Mensaje de selección -->
      <div class="selection-message" *ngIf="calificacion > 0">
        <span class="message-text">{{ getMensajeCalificacion() }}</span>
      </div>
    </div>

    <!-- Comentario -->
    <div class="input-group">
      <label>Cuéntanos más sobre tu experiencia <span class="optional">(opcional)</span></label>
      <textarea [(ngModel)]="comentario" placeholder="Comparte tus comentarios para ayudarnos a mejorar..."
        rows="3"></textarea>
    </div>
  </div>


  <!-- ⭐ Vista para ADMIN -->
  <div *ngIf="rol === 'admin'" class="admin-section">

    <div class="summary-grid">
      <div class="summary-card">
        <label>Puntuación del Usuario</label>
        <div class="value-box">
          <span class="rating-value" *ngIf="data.calificacion">
            {{ data.calificacion }} ★
          </span>
          <span class="no-data" *ngIf="!data.calificacion">Sin calificar</span>
        </div>
      </div>

      <div class="summary-card full-width">
        <label>Comentario del Usuario</label>
        <div class="value-box">
          <p>{{ data.comentario || 'Sin comentario' }}</p>
        </div>
      </div>

      <div class="summary-card full-width">
        <label>Observación Técnica</label>
        <div class="value-box">
          <p>{{ data.observacionTecnico || 'Ninguna observación registrada' }}</p>
        </div>
      </div>
    </div>
  </div>

</div>

<!-- Modal Actions -->
<div class="modal-actions">
  <button class="btn-cancel" (click)="cerrar()">
    Cancelar
  </button>

  <button class="btn-save" *ngIf="rol !== 'admin'" (click)="guardar()">
    {{ rol === 'usuario' ? 'Enviar Calificación' : 'Guardar Observación' }}
  </button>
</div>