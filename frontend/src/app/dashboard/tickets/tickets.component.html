<!-- DASHBOARD PRINCIPAL -->
<mat-toolbar class="modern-toolbar">
  <mat-icon class="toolbar-icon">dashboard</mat-icon>
  <span>Panel de Control - Municipalidad de San Román</span>
</mat-toolbar>

<div class="dashboard-container">

  <h2 class="titulo">Resumen General</h2>

  <!-- TARJETAS PRINCIPALES -->
  <div class="stats-grid">
    <mat-card class="stat-card card-blue">
      <mat-icon class="card-icon">new_releases</mat-icon>
      <div class="card-content">
        <div class="card-title">Tickets Nuevos</div>
        <div class="card-number">{{ resumen.nuevos }}</div>
      </div>
    </mat-card>

    <mat-card class="stat-card card-purple">
      <mat-icon class="card-icon">schedule</mat-icon>
      <div class="card-content">
        <div class="card-title">Tiempo Promedio</div>
        <div class="card-number">{{ resumen.promedioSolucion }}</div>
      </div>
    </mat-card>

    <mat-card class="stat-card card-green">
      <mat-icon class="card-icon">check_circle</mat-icon>
      <div class="card-content">
        <div class="card-title">Resueltos Hoy</div>
        <div class="card-number">{{ resumen.resueltosHoy }}</div>
      </div>
    </mat-card>

    <mat-card class="stat-card card-orange">
      <mat-icon class="card-icon">assessment</mat-icon>
      <div class="card-content">
        <div class="card-title">Total de Tickets</div>
        <div class="card-number">{{ resumen.total }}</div>
      </div>
    </mat-card>
  </div>

  <!-- GRÁFICOS -->
  <div class="charts-grid">
    <mat-card class="chart-card">
      <mat-card-header class="chart-header">
        <mat-icon class="chart-icon">pie_chart</mat-icon>
        <mat-card-title>Tickets por Estado</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <canvas *ngIf="pieChartData" baseChart [data]="pieChartData" [options]="pieChartOptions" [type]="'pie'">
        </canvas>
      </mat-card-content>
    </mat-card>

    <mat-card class="chart-card">
      <mat-card-header class="chart-header">
        <mat-icon class="chart-icon">show_chart</mat-icon>
        <mat-card-title>Evolución de Tickets por Mes</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <canvas *ngIf="lineChartData && lineChartData.datasets && lineChartData.datasets.length > 0" baseChart
          [data]="lineChartData" [options]="lineChartOptions" [type]="'line'">
        </canvas>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Botón de reporte (solo admin) -->
  <div class="action-center">
    <button mat-raised-button class="btn-report" *ngIf="authService.tieneRol('admin')" (click)="abrirModal()">
      <mat-icon>description</mat-icon>
      Generar Reporte
    </button>
  </div>

</div>

<!-- MODAL GENERAR REPORTE -->
<app-reporte-modal [isOpen]="modalAbierto" [oficinas]="oficinas" (closeModal)="cerrarModal()"></app-reporte-modal>