<div class="layout">
  <main class="dashboard-container">
  
    <h2 class="titulo">Panel de Control</h2>

    <!-- TARJETAS PRINCIPALES -->
    <div class="stats-grid">
      <div class="stat-card azul">
        <h3>Tickets Nuevos</h3>
        <p>{{ resumen.nuevos }}</p>
      </div>

      <div class="stat-card verde">
        <h3>Tiempo promedio de solución</h3>
        <p>{{ resumen.promedioSolucion }}</p>
      </div>

      <div class="stat-card morado">
        <h3>Tickets resueltos hoy</h3>
        <p>{{ resumen.resueltosHoy }}</p>
      </div>

      <div class="stat-card gris">
        <h3>Total de Tickets</h3>
        <p>{{ resumen.total }}</p>
      </div>
    </div>

    <!-- GRÁFICOS -->
    <div class="charts-grid">
      <div class="chart-card">
        <h4>Tickets por Estado</h4>
        <canvas *ngIf="pieChartData"
          baseChart
          [data]="pieChartData"
          [options]="pieChartOptions"
          [type]="'pie'"
          style="width:10px; height:10px;">
        </canvas>
      </div>

      <div class="chart-card">
        <h4>Evolución de Tickets por Mes</h4>
        <canvas *ngIf="lineChartData && lineChartData.datasets && lineChartData.datasets.length > 0"
          baseChart
          [data]="lineChartData"
          [options]="lineChartOptions"
          [type]="'line'">
        </canvas>
      </div>
    </div>

    <!-- Botón de reporte (solo admin) -->
    <div class="text-center mt-4">
      <button 
        *ngIf="authService.tieneRol('admin')" 
        class="btn-reporte"
        (click)="abrirModal()">
        Generar Reporte
      </button>
    </div>
    

  </main>
</div>
<!-- Modal -->
<div class="modal-overlay" *ngIf="modalAbierto">
  <div class="modal-container">

    <div class="modal-header">
      <h3>Generar Reporte</h3>
      <button class="close-btn" (click)="cerrarModal()">✕</button>
    </div>

    <!-- Tabs -->
    <div class="tabs">
      <button 
        class="tab" 
        [class.active]="tabActiva === 'pdf'" 
        (click)="tabActiva = 'pdf'">
        PDF
      </button>

      <button 
        class="tab" 
        [class.active]="tabActiva === 'excel'" 
        (click)="tabActiva = 'excel'">
        Excel
      </button>
    </div>

    <div class="modal-body">

      <!-- PDF -->
      <div *ngIf="tabActiva === 'pdf'">
        <p>Configura filtros para generar un reporte en PDF.</p>

        <!-- Filtros -->
        <div class="filtros">

          <label>Fecha inicial</label>
          <input type="date" [(ngModel)]="filtros.fechaInicio">

          <label>Fecha final</label>
          <input type="date" [(ngModel)]="filtros.fechaFin">

          <label>Oficina (opcional)</label>
          <select [(ngModel)]="usuario.idOficina">
            <option value="Todos">Todos</option>
            <option *ngFor="let o of oficinas" [value]="o.idOficina">{{ o.nombreOficina }}</option>
          </select>

        </div>

        <button class="btn-pdf" (click)="generarPDF()">Descargar PDF</button>
      </div>

      <!-- Excel -->
      <div *ngIf="tabActiva === 'excel'">
        <p>Configura filtros para generar un reporte en Excel.</p>

        <!-- Filtros -->
        <div class="filtros">

          <label>Fecha inicial</label>
          <input type="date" [(ngModel)]="filtros.fechaInicio">

          <label>Fecha final</label>
          <input type="date" [(ngModel)]="filtros.fechaFin">

          <label>Oficina (opcional)</label>
          <select [(ngModel)]="usuario.idOficina">
            <option value="">Todas</option>
            <option *ngFor="let o of oficinas" [value]="o.idOficina">{{ o.nombreOficina }}</option>
          
          </select>

        </div>

        <button class="btn-excel" (click)="generarExcel(oficinaSeleccionada)">Descargar Excel</button>
      </div>


    </div>

  </div>
</div>


